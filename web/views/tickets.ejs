<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Capi Netta | Tickets</title>
    <link rel="stylesheet" href="/style.css?v=<%= Date.now() %>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>

    <!-- Hamburger Menu Button -->
    <button class="hamburger" id="hamburger" title="Men√∫">‚ò∞</button>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="brand">CAPI NETTA RP</div>
        <ul class="nav-links">
            <li><a href="/dashboard">üìä Dashboard</a></li>
            <li><a href="/tickets" class="active">üé´ Tickets</a></li>
            <li><a href="/logs">üìú Logs Totales</a></li>
            <li><hr style="border: 1px solid var(--border-color); margin: 15px 0;"></li>
            <li><a href="javascript:void(0)" onclick="alert('Secci√≥n en desarrollo')">‚öôÔ∏è Configuraci√≥n</a></li>
            <li><a href="javascript:void(0)" onclick="alert('Secci√≥n en desarrollo')">‚ö†Ô∏è Sistema de Warns</a></li>
            <li><a href="javascript:void(0)" onclick="alert('Secci√≥n en desarrollo')">üëë Gesti√≥n de Roles</a></li>
            <li><a href="javascript:void(0)" onclick="alert('Secci√≥n en desarrollo')">üì¢ Canales</a></li>
            <li><a href="javascript:void(0)" onclick="alert('Secci√≥n en desarrollo')">üìà Estad√≠sticas</a></li>
            <li><hr style="border: 1px solid var(--border-color); margin: 15px 0;"></li>
            <li><a href="javascript:void(0)" onclick="alert('Secci√≥n en desarrollo')">‚ÑπÔ∏è Acerca de</a></li>
            <li><a href="javascript:void(0)" onclick="alert('Secci√≥n en desarrollo')">‚ùì Ayuda</a></li>
        </ul>

        <div class="user-info">
            <% if (user.avatar) { %>
                <img src="https://cdn.discordapp.com/avatars/<%= user.id %>/<%= user.avatar %>.png" class="user-avatar"
                    alt="Avatar">
                <% } else { %>
                    <img src="https://cdn.discordapp.com/embed/avatars/0.png" class="user-avatar" alt="Avatar">
                    <% } %>
                        <div class="user-details">
                            <div class="username">
                                <%= user.username %>
                            </div>
                            <a href="/logout" class="logout-btn">Cerrar Sesi√≥n</a>
                        </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <h1>üé´ Gesti√≥n de Tickets</h1>

        <form method="get" class="filter-bar">
            <select name="status">
                <option value="">Estado: Todos</option>
                <option value="open" <%= filters.status==='open' ? 'selected' : '' %>>Abiertos</option>
                <option value="claimed" <%= filters.status==='claimed' ? 'selected' : '' %>>Reclamados</option>
                <option value="closed" <%= filters.status==='closed' ? 'selected' : '' %>>Cerrados</option>
                <option value="archived" <%= filters.status==='archived' ? 'selected' : '' %>>Archivados</option>
            </select>

            <select name="claimed">
                <option value="">Claim: Todos</option>
                <option value="true" <%= filters.claimed==='true' ? 'selected' : '' %>>Con due√±o</option>
                <option value="false" <%= filters.claimed==='false' ? 'selected' : '' %>>Sin due√±o</option>
            </select>

            <select name="type">
                <option value="">Tipo: Todos</option>
                <% types.forEach(t => { %>
                    <option value="<%= t.type %>" <%= filters.type===t.type ? 'selected' : '' %>><%= t.type || 'N/A' %> (<%= t._count.type %>)</option>
                <% }) %>
            </select>

            <button type="submit">Filtrar</button>
            <a class="clear-filters" href="/tickets">Limpiar</a>
        </form>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Estado</th>
                        <th>Creado Por</th>
                        <th>Tipo</th>
                        <th>Fecha</th>
                        <th>Claimed By</th>
                    </tr>
                </thead>
                <tbody>
                    <% tickets.forEach(ticket=> { %>
                        <tr>
                            <td>#<%= ticket.ticketId %></td>
                            <td>
                                <% if (ticket.status==='open' ) { %>
                                    <span class="badge open">ABIERTO</span>
                                <% } else if (ticket.status==='claimed' ) { %>
                                    <span class="badge claimed">RECLAMADO</span>
                                <% } else if (ticket.status==='archived' ) { %>
                                    <span class="badge archived">ARCHIVADO</span>
                                <% } else { %>
                                    <span class="badge closed">CERRADO</span>
                                <% } %>
                            </td>
                            <td><%= ticket.userId %></td>
                            <td><%= ticket.type || 'N/A' %></td>
                            <td><%= new Date(ticket.createdAt).toLocaleString() %></td>
                            <td><%= ticket.claimedBy || '-' %></td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>

    </main>

</body>

<script>
    // Toggle sidebar en m√≥vil y desktop
    const hamburger = document.getElementById('hamburger');
    const sidebar = document.getElementById('sidebar');

    if (hamburger) {
        hamburger.addEventListener('click', () => {
            sidebar.classList.toggle('hidden');
        });

        // Cerrar sidebar al hacer click en un link
        const links = sidebar.querySelectorAll('a');
        links.forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth <= 768) {
                    sidebar.classList.add('hidden');
                }
            });
        });

        // Cerrar sidebar al hacer click fuera (solo en m√≥vil)
        document.addEventListener('click', (e) => {
            if (!sidebar.contains(e.target) && !hamburger.contains(e.target)) {
                if (window.innerWidth <= 768) {
                    sidebar.classList.add('hidden');
                }
            }
        });
    }
</script>

</html>